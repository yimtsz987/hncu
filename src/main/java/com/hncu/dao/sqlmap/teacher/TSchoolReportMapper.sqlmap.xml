<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hncu.dao.mapper.teacher.TSchoolReportMapper">
    <sql id="schoolReportColumns">
        sr.id,
        sr.report_id as "reportId",
        sr.student_id as "studentId",
        sr.score,
        sr.pass_flag as "passFlag",
        sr.date_time as "dateTime",
        sr.old_score as "oldScore",
        sr.createBy,
        sr.teacherComment,
        sr.year
    </sql>

    <select id="queryList" parameterType="SchoolReport" resultType="SchoolReport">
        SELECT <include refid="schoolReportColumns" />
        FROM school_report sr
        WHERE sr.year = #{sysYear, jdbcType=VARCHAR}
        <if test="studentId != null and studentId != ''">
            and sr.student_id = #{studentId,jdbcType=INTEGER}
        </if>
        <if test="passFlag != null and passFlag != ''">
            and sr.pass_flag = #{passFlag,jdbcType=INTEGER}
        </if>
        ORDER BY sr.id ASC
    </select>

    <select id="queryById" parameterType="string" resultType="SchoolReport">
        SELECT <include refid="schoolReportColumns" />
        FROM school_report sr
        WHERE sr.id = #{id, jdbcType=NUMERIC}
    </select>

    <insert id="uploadSchoolReport" parameterType="SchoolReport" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO school_report(report_id,student_id,score,pass_flag,date_time,year,createBy,teacherComment)
        VALUES (#{reportId,jdbcType=INTEGER},#{studentId,jdbcType=INTEGER},#{score,jdbcType=VARCHAR},#{passFlag,jdbcType=INTEGER},#{dateTime,jdbcType=TIMESTAMP},#{sysYear, jdbcType=VARCHAR},#{createById,jdbcType=INTEGER},#{teacherComment, jdbcType=VARCHAR})
    </insert>

    <update id="updateSchoolReport" parameterType="SchoolReport">
        UPDATE school_report SET score = #{score,jdbcType=VARCHAR},pass_flag = #{passFlag,jdbcType=INTEGER},date_time = #{dateTime,jdbcType=TIMESTAMP}
        WHERE id = #{id,jdbcType=INTEGER}
    </update>

    <insert id="insertSecondAnswer" parameterType="SchoolReport">
        INSERT INTO second_answer(student_id,year)
        VALUES (#{studentId,jdbcType=INTEGER},#{sysYear, jdbcType=VARCHAR})
    </insert>

    <delete id="deleteSecondAnswer" parameterType="SchoolReport">
        DELETE FROM second_answer WHERE student_id = #{studentId,jdbcType=INTEGER}
    </delete>

    <update id="updateStudentStep" parameterType="User">
        UPDATE expand_student SET step_9 = #{STEP_FLAG_PASS,jdbcType=INTEGER},step_now = #{STEP_NOW_10,jdbcType=INTEGER},school_report_id = #{student.schoolReportId,jdbcType=INTEGER} WHERE s_id = #{id,jdbcType=INTEGER}
    </update>
</mapper>